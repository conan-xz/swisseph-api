# Swiss Ephemeris API æµ‹è¯•æ–‡æ¡£

## æ¦‚è¿°

æœ¬é¡¹ç›®æä¾›äº†ä¸¤ä¸ªæµ‹è¯•è„šæœ¬æ¥éªŒè¯ Swiss Ephemeris API æœåŠ¡ã€‚

## æµ‹è¯•è„šæœ¬

### 1. `test.sh` - å¿«é€Ÿæµ‹è¯•è„šæœ¬

å¿«é€Ÿæ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€çš„ Shell è„šæœ¬ã€‚

#### ä½¿ç”¨æ–¹æ³•

```bash
# æµ‹è¯•æœ¬åœ°æœåŠ¡ (é»˜è®¤ localhost:3000)
./test.sh

# æµ‹è¯•æŒ‡å®šæœåŠ¡
./test.sh http://localhost:3000
./test.sh https://your-service.cloudurl.cn
```

#### æµ‹è¯•å†…å®¹

- âœ… HTTP ç«¯ç‚¹å¥åº·æ£€æŸ¥
- âœ… Socket.IO å®¢æˆ·ç«¯åº“å¯è®¿é—®æ€§
- âœ… æœåŠ¡ä¿¡æ¯æ˜¾ç¤º
- âœ… å®Œæ•´ API åŠŸèƒ½æµ‹è¯• (éœ€è¦ Node.js)

---

### 2. `test-api.js` - Node.js API æµ‹è¯•

å®Œæ•´çš„ API åŠŸèƒ½æµ‹è¯•è„šæœ¬ï¼Œä½¿ç”¨ Socket.IO å®¢æˆ·ç«¯è¿›è¡Œæ·±åº¦æµ‹è¯•ã€‚

#### ä¾èµ–

éœ€è¦å®‰è£… `socket.io-client`ï¼š

```bash
npm install --save-dev socket.io-client
```

#### ä½¿ç”¨æ–¹æ³•

```bash
# æµ‹è¯•æœ¬åœ°æœåŠ¡
node test-api.js

# æµ‹è¯•æŒ‡å®šæœåŠ¡
node test-api.js http://localhost:3000
node test-api.js https://your-service.cloudurl.cn
```

#### æµ‹è¯•ç”¨ä¾‹

1. **è®¡ç®—å¤ªé˜³ä½ç½®** - æµ‹è¯•åŸºæœ¬çš„æ˜Ÿå†è®¡ç®—
2. **è®¡ç®—æœˆçƒä½ç½®** - æµ‹è¯•å¸¦åœ°ç†åæ ‡çš„è§‚æµ‹
3. **è®¡ç®—æ‰€æœ‰è¡Œæ˜Ÿ** - æ‰¹é‡æµ‹è¯•å¤ªé˜³ç³»ä¸»è¦å¤©ä½“
4. **è®¡ç®—ç‰¹å®šæ—¥æœŸ** - æµ‹è¯•å†å²æ˜Ÿå†æ•°æ® (DE431)

#### è¾“å‡ºç¤ºä¾‹

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Swiss Ephemeris API Test Suite
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Target: http://localhost:3000
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸŒ HTTP GET http://localhost:3000/
   Status: 200
   âœ… Response length: 5432 bytes

ğŸ”Œ Connecting to Socket.IO...
   âœ… Connected successfully
   Socket ID: abc123...

ğŸ“‹ Test: Calculate Sun Position
   âœ… Result 1/1: { "body": {...}, "position": {...} }

ğŸ“‹ Test: Calculate Moon Position
   âœ… Result 1/1: { "body": {...}, "position": {...} }

...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Test Summary
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Total:  4
  Passed: 4 âœ…
  Failed: 0 âŒ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## API ä½¿ç”¨è¯´æ˜

### Socket.IO æ¥å£

#### è¿æ¥

```javascript
const io = require('socket.io-client');
const socket = io('http://localhost:3000');
```

#### å‘é€è®¡ç®—è¯·æ±‚

```javascript
socket.emit('swisseph', [{
  func: 'calc',
  args: [{
    date: {
      gregorian: {
        terrestrial: '2024-01-01T00:00:00.000Z'
      }
    },
    observer: {
      ephemeris: 'swisseph',  // or de200, de405, de406, de414, de421, de422, de431, moshier
      geographic: {
        longitude: 116.4074,  // ç»åº¦ (ä¸œç»æ­£, è¥¿ç»è´Ÿ)
        latitude: 39.9042,    // çº¬åº¦ (åŒ—çº¬æ­£, å—çº¬è´Ÿ)
        height: 43            // æµ·æ‹”é«˜åº¦ (ç±³)
      }
    },
    body: {
      id: 0  // å¤©ä½“ ID (0=Sun, 1=Moon, 2=Mercury, ..., 9=Pluto)
    }
  }]
}]);
```

#### æ¥æ”¶è®¡ç®—ç»“æœ

```javascript
socket.on('swisseph result', (result) => {
  console.log(result);
});
```

#### å¤©ä½“ ID åˆ—è¡¨

| ID  | å¤©ä½“åç§°        | ID  | å¤©ä½“åç§°           |
|-----|---------------|-----|-------------------|
| 0   | Sun (å¤ªé˜³)     | 21  | Moon Interpolated Apogee |
| 1   | Moon (æœˆäº®)    | 22  | Moon Interpolated Perigee |
| 2   | Mercury (æ°´æ˜Ÿ)  | 15  | Chiron            |
| 3   | Venus (é‡‘æ˜Ÿ)   | 16  | Pholus            |
| 4   | Mars (ç«æ˜Ÿ)    | 17  | Ceres            |
| 5   | Jupiter (æœ¨æ˜Ÿ) | 18  | Pallas           |
| 6   | Saturn (åœŸæ˜Ÿ)  | 19  | Juno             |
| 7   | Uranus (å¤©ç‹æ˜Ÿ)| 20  | Vesta            |
| 8   | Neptune (æµ·ç‹æ˜Ÿ)| 40-49 | Transneptunian |
| 9   | Pluto (å†¥ç‹æ˜Ÿ) | 50-54 | Other objects   |
| 10  | Moon Mean Node |     |                   |
| 11  | Moon True Node |     |                   |
| 12  | Moon Mean Apogee |   |                   |
| 13  | Moon Osculating Apogee | |                   |

---

## å¾®ä¿¡äº‘æ‰˜ç®¡éƒ¨ç½²æµ‹è¯•

éƒ¨ç½²åˆ°å¾®ä¿¡äº‘æ‰˜ç®¡åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯•ï¼š

```bash
# ä½¿ç”¨ä½ çš„å¾®ä¿¡äº‘æ‰˜ç®¡æœåŠ¡åœ°å€
./test.sh https://your-service.cloudurl.cn

# æˆ–ä½¿ç”¨ Node.js æµ‹è¯•
node test-api.js https://your-service.cloudurl.cn
```

---

## æ•…éšœæ’æŸ¥

### è¿æ¥å¤±è´¥

1. æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
3. ç¡®è®¤ç«¯å£ (é»˜è®¤ 3000) æ˜¯å¦æ­£ç¡®
4. æ£€æŸ¥å¾®ä¿¡äº‘æ‰˜ç®¡æœåŠ¡æ˜¯å¦å·²å¯åŠ¨

### è¶…æ—¶é”™è¯¯

å¢åŠ æµ‹è¯•è„šæœ¬çš„è¶…æ—¶æ—¶é—´ï¼ˆç¼–è¾‘ `test-api.js` ä¸­çš„ `TIMEOUT` å¸¸é‡ï¼‰

### è®¡ç®—ç»“æœå¼‚å¸¸

- æ£€æŸ¥è¾“å…¥æ—¥æœŸæ ¼å¼æ˜¯å¦æ­£ç¡® (ISO 8601)
- ç¡®è®¤ ephemeris è·¯å¾„æ˜¯å¦æ­£ç¡®è®¾ç½®
- éªŒè¯å¤©ä½“ ID æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…

---

## å¼€å‘å»ºè®®

1. æœ¬åœ°å¼€å‘æ—¶ä½¿ç”¨ `npm start` å¯åŠ¨æœåŠ¡
2. ä½¿ç”¨ `test-api.js` è¿›è¡Œå¿«é€Ÿæµ‹è¯•
3. å¾®ä¿¡äº‘æ‰˜ç®¡éƒ¨ç½²å‰å…ˆæœ¬åœ°éªŒè¯
4. æŸ¥çœ‹æœåŠ¡æ—¥å¿—æ’æŸ¥é—®é¢˜
